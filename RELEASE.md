# 更新日志

## v0.5 - 2026-01-04

### 🌐 国际化

#### 存储管理页面
- 存储提供商选项支持中英文翻译
- 图片预览 alt 属性国际化

### 🔧 路径修复

#### 上传路径显示优化
- 上传页面始终显示根路径前缀（配置的 Path Prefix 或 `/`）
- 用户可清楚看到当前根路径，避免输入重复路径

#### 已上传图片路径编辑修复
- 编辑照片路径时显示 `/` 前缀，表示从存储桶根路径开始
- 修复 R2、GitHub 存储的 `move` 方法，保存时直接使用绝对路径
- 解决路径重复问题（如 `2026/2026/xxx.jpg`）

---

## 2026-01-03

### 💾 本地草稿系统

#### 博客自动保存
- 博客编辑器新增自动保存功能
- 编辑内容每 2 秒自动保存到本地 IndexedDB
- 支持多条博客草稿同时保存
- 重新编辑时自动恢复最新草稿
- 发布成功后自动清理对应草稿

#### 草稿管理页面
- 新增「草稿」Tab 页面，统一管理所有本地草稿
- 显示叙事草稿（来自快速编辑器，只读）
- 显示博客草稿列表（可删除）
- 支持预览草稿内容
- 显示草稿保存时间和状态

### 🔒 安全增强

#### 照片删除保护
- 新增照片删除前的叙事关联校验功能
- 如果照片已关联到叙事（Story），将无法直接删除
- 删除确认对话框会显示关联的叙事列表
- 用户需要先从叙事中移除这些照片，然后再删除

### ✨ 叙事系统更新

#### 列表页面重新设计
- 叙事列表采用非对称网格布局重新设计
- 更现代化的视觉呈现

#### 快速编辑器增强
- 新增文件重排序功能
- 嵌入快速创建工具入口
- 优化编辑体验

---

### 📝 API 变更

#### 后端 API
- 新增 `GET /api/admin/photos/:id/stories` - 查询单张照片关联的叙事
- 新增 `POST /api/admin/photos/check-stories` - 批量检查多张照片的叙事关联
- 修改 `DELETE /api/admin/photos/:id` - 删除前检查叙事关联，如有关联返回错误

#### 前端
- 修改删除确认对话框，支持显示关联叙事警告
- 添加加载状态显示
- 如果有关联叙事，仅显示取消按钮，阻止删除操作

#### 国际化
- 添加中英文提示文本支持

---

## 2026-01-02

### ✨ 新功能

#### 叙事系统增强
- 新增叙事预览模态框，支持画廊和灯箱效果

#### 管理后台改进
- 上传表单增强：分类可选，显示存储路径
- 相册工具栏重新设计，支持可折叠筛选器
- 精选照片切换 UX 改进
- 照片详情面板显示存储路径
- Tab 组件与路由页面整合

#### 编辑器优化
- Milkdown 编辑器添加浅色模式文字颜色覆盖

#### 部署配置
- Docker 配置添加中国镜像仓库支持
- 简化并重组 .env.example 配置文件